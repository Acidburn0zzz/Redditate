/*
* Redditate
* Copyright 2011, Dave Gamache
* www.redditate.com
* Free to use under the MIT license.
* http://www.opensource.org/licenses/mit-license.php
* 10/01/2011
*/
$(document).ready(function(){function g(){$.getJSON("http://www.reddit.com/"+h+".json?limit=25&after="+l+"&jsonp=?",null,function(a){$.each(a.data.children,function(a,b){var d=b.data,c=$("#postTemplate").html(),d=Handlebars.compile(c)(d);o.append(d);l=b.data.name})}).complete(function(){i.fadeOut(100);m.removeClass("loading");p();d=$(".post")})}function p(){$("img").not("already-classified").imagesLoaded(function(){$(this).each(function(){$(this).addClass("already-classified");$(this).width()==880?
$(this).addClass("not-resizeable"):$(this).width()!=880&&$(this).height()!=501&&$(this).addClass("not-resizeable")})})}function n(a){if(a.children("img").hasClass("fullwidth")){var b=a.children("img").offset();b.top<$(window).scrollTop()&&window.scrollTo(b.left,b.top-$("nav").height()-10)}a.children("img").toggleClass("fullwidth")}function j(a){a=a.data("viewType");$("body").removeClass("listview").removeClass("fullview").addClass(a);window.scrollTo(0,d.eq(b-1).offset().top);$.cookie("viewType",null);
$.cookie("viewType",a,{expires:100})}function k(){$("body").removeClass("subreddit-picker-open");$(".subreddit-picker").slideUp(250)}var o=$(".posts"),l,h=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=RegExp("[\\?&]"+a+"=([^&#]*)").exec(window.location.href);return a==null?"":a[1]}("r"),i=$(".wash"),m=$(".loadmore-button"),b=0,d,e=$(".subreddit-hint p"),c=0;$.cookie("viewType")&&$("body").removeClass("fullview").removeClass("listview").addClass($.cookie("viewType"));g();$(window).scroll(function(){$(window).scrollTop()==
$(document).height()-$(window).height()&&!navigator.userAgent.match(/iPhone/i)&&!navigator.userAgent.match(/iPod/i)&&!navigator.userAgent.match(/iPad/i)&&(i.fadeIn(100),g());$(document).scrollTop()>d.eq(b).offset().top-90&&b++;$(document).scrollTop()<d.eq(b-1).offset().top-90&&b-1>0&&b--});$(".loadmore-button").click(function(){i.fadeIn(100);m.addClass("loading");g()});if(!h==""){var f=h.replace("r/","");$(".logo .subreddit .title").text(f);document.title="Redditate: "+f}Handlebars.registerHelper("hasImage",
function(a){/imgur*/.test(a)&&!/\.(?=gif|jpg|png)/gi.test(a)&&(a+=".jpg");return/\.(?=gif|jpg|png)/gi.test(a)?'<a class="image-embed"><img src="'+a+'" alt="" /></a>':!1});Handlebars.registerHelper("hasYoutube",function(a){return a.indexOf("youtube")!=-1?(youtubeID=a.replace(/^[^v]+v.(.{11}).*/,"$1"),youtubeLinkTime=a.split("#"),youtubeLinkTime=youtubeLinkTime[1],'<iframe width="420" height="345" src="http://www.youtube.com/embed/'+youtubeID+"?wmode=transparent&#"+youtubeLinkTime+'" frameborder="0" wmode="Opaque" allowfullscreen></iframe>'):
!1});Handlebars.registerHelper("hasThumbnail",function(a,b){return a!=""?'<a class="thumbnail-embed" href="'+b+'" target="_blank"><img src="'+a+'" alt="" /></a>':!1});$(".post .image-embed").live("click",function(a){a.preventDefault();n($(this))});$(".view-options a").click(function(a){a.preventDefault();j($(this))});$(".subreddit").click(function(a){a.preventDefault();$("body").addClass("subreddit-picker-open");$(".subreddit-picker").slideDown(250)});$(".subreddit-close-button").click(function(a){a.preventDefault();
k()});$(".subreddit-heading").click(function(a){a.preventDefault();k()});e.eq(c).show();$(".down-carrot-wrapper").click(function(){e.hide();c<e.length-1?c++:c=0;e.eq(c).show()});document.onkeydown=function(a){a=a||window.event;a.keyCode==27&&k();if(a.keyCode==74)if(b==$(".post").length-1)$("body").scrollTop($(document).height());else{var c=$(".post").eq(b).offset();window.scrollTo(c.left,c.top-$("nav").height()-10)}a.keyCode==75&&b>1&&(c=$(".post").eq(b-2).offset(),window.scrollTo(c.left,c.top-$("nav").height()-
10));a.keyCode==70&&j($("a.fullview"));a.keyCode==76&&j($("a.listview"));a.keyCode==90&&n(d.eq(b-1).find(".image-embed"));a.keyCode==67&&(c=d.eq(b-1).find(".permalink").attr("href"),window.open(c,"_newtab"));a.keyCode==13&&(a=d.eq(b-1).find(".post-title").attr("href"),window.open(a,"_newtab"))};var f=document.getElementById("loading"),q=document.getElementById("spinner");(new Spinner({width:2})).spin(f);(new Spinner({width:2,radius:6,length:4})).spin(q)});